#!/bin/sh

NOTIF_ID=123

# start the daemon
mpd 2>/dev/null >/dev/null

# start the notification daemon
pgrep mpd-notificatio >/dev/null || {
    # https://stackoverflow.com/a/10408906
    nohup mpd-notification </dev/null >/dev/null 2>&1 &
}

case "$1" in
    notif)
        mpc idleloop | while read -r _; do
            s=$(mpc status | head -n1)
            dunstify -r $NOTIF_ID Music "$s"
        done ;;
    find)
        song="$(mpc search any '' | fzf --reverse)"
        [ "$song" ] && {
            mpc insert "$song"
            mpc next
        };;
    *)
        if command -v bicon.bin >/dev/null; then
            exec bicon.bin ncmpcpp "$@"
        else
            exec ncmpcpp "$@"
        fi
esac
