#!/bin/sh

F=$(realpath "$1")

dir=.
img=
opt='-t'
[ "$F" ] && {
    [ -f "$F" ] && {
        dir=$(dirname "$F")
        img="$F"
        opt=''
    } || dir="$F"
}

cd "$dir" || (echo "Failed cd to $dir" && exit 1)

file --mime-type ./* | grep video/ | awk -F':' '{print $1}' |
    while read -r f; do
        [ -f "$f" ] && {
            t="$f.thumb.jpg"
            [ ! -f "$t" ] &&
                ffmpegthumbnailer -i "$f" -o "$t" -s 0 >/dev/null 2>/dev/null
        }
    done

if [ "$img" != '' ] && [ -f "$img" ]; then
    sxiv -b -F "$img" $opt .
else
    sxiv -b $opt .
fi
