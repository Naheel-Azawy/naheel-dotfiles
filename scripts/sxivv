#!/bin/sh

dir=.
img=
opt='-t'
[ "$1" ] && {
    [ -f "$1" ] && {
        dir=$(dirname "$1")
        img="$1"
        opt=''
    } || dir="$1"
}

cd "$dir" || (echo "Failed cd to $dir" && exit 1)

file --mime-type ./* | grep video/ | awk -F':' '{print $1}' |
    while read -r f; do
        [ -f "$f" ] && {
            t="$f.thumb.jpg"
            [ ! -f "$t" ] &&
                ffmpegthumbnailer -i "$f" -o "$t" -s 0 >/dev/null 2>/dev/null
        }
    done

[ "$img" != '' ] && [ -f "$img" ] && {
    opt="$opt -F $img"
}

sxiv -b $opt .
